<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClawOS Desktop v2.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        body { font-family: 'VT323', monospace; background: #0a0a0a; color: #33ff33; height: 100vh; overflow: hidden; }
        
        /* CRT effects */
        .scanlines { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 1px, transparent 1px, transparent 3px); }
        .crt-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9998;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.7); }
        
        /* Desktop */
        #desktop { width: 100%; height: calc(100vh - 40px); position: relative; overflow: hidden;
            background: #0a0a0a url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 30h60M30 0v60' stroke='%23111' stroke-width='0.5'/%3E%3C/svg%3E") repeat; }
        
        /* Desktop icons */
        .desktop-icon { position: absolute; width: 80px; text-align: center; cursor: pointer; padding: 8px 4px; border-radius: 4px; transition: background 0.15s; }
        .desktop-icon:hover { background: rgba(51, 255, 51, 0.1); }
        .desktop-icon:active { background: rgba(51, 255, 51, 0.2); }
        .desktop-icon .icon { font-size: 36px; line-height: 1; }
        .desktop-icon .label { font-size: 14px; margin-top: 4px; color: #33ff33; text-shadow: 1px 1px 2px #000; word-wrap: break-word; }
        
        /* Windows */
        .window { position: absolute; min-width: 300px; min-height: 200px; border: 2px solid #33ff33; background: #0a0a0a;
            box-shadow: 0 0 20px rgba(51, 255, 51, 0.1), 4px 4px 0 rgba(0,0,0,0.5); display: flex; flex-direction: column; }
        .window.focused { z-index: 100; border-color: #66ff66; box-shadow: 0 0 30px rgba(51, 255, 51, 0.2), 4px 4px 0 rgba(0,0,0,0.5); }
        .window-titlebar { background: #1a5e1a; color: #0a0a0a; padding: 4px 8px; display: flex; justify-content: space-between; align-items: center;
            cursor: move; flex-shrink: 0; font-size: 16px; }
        .window.focused .window-titlebar { background: #33ff33; }
        .window-title { font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .window-controls { display: flex; gap: 4px; }
        .window-controls span { cursor: pointer; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;
            background: #0a0a0a; color: #33ff33; font-size: 14px; border: 1px solid #33ff33; }
        .window-controls span:hover { background: #33ff33; color: #0a0a0a; }
        .window-body { flex: 1; overflow: auto; padding: 0; position: relative;
            scrollbar-width: thin; scrollbar-color: #33ff33 #0a0a0a; }
        .window-body::-webkit-scrollbar { width: 8px; }
        .window-body::-webkit-scrollbar-thumb { background: #33ff33; }
        .window-body::-webkit-scrollbar-track { background: #0a0a0a; }
        .window-resize { position: absolute; bottom: 0; right: 0; width: 16px; height: 16px; cursor: nwse-resize;
            background: linear-gradient(135deg, transparent 50%, #33ff33 50%); opacity: 0.5; }
        .window-resize:hover { opacity: 1; }
        
        /* Taskbar */
        #taskbar { height: 40px; background: #111; border-top: 2px solid #33ff33; display: flex; align-items: center;
            padding: 0 8px; gap: 4px; position: fixed; bottom: 0; width: 100%; z-index: 500; }
        #start-btn { background: #33ff33; color: #0a0a0a; border: none; font-family: 'VT323', monospace; font-size: 18px;
            padding: 4px 12px; cursor: pointer; font-weight: bold; }
        #start-btn:hover { background: #66ff66; }
        .taskbar-item { background: #1a1a1a; border: 1px solid #1a5e1a; color: #33ff33; padding: 4px 12px;
            font-family: 'VT323', monospace; font-size: 15px; cursor: pointer; max-width: 160px;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .taskbar-item.active { background: #1a3a1a; border-color: #33ff33; }
        .taskbar-item:hover { background: #1a3a1a; }
        #taskbar-clock { margin-left: auto; color: #1a9e1a; font-size: 16px; padding-right: 8px; }
        
        /* Start menu */
        #start-menu { position: fixed; bottom: 42px; left: 0; background: #111; border: 2px solid #33ff33;
            width: 220px; display: none; z-index: 600; box-shadow: 0 0 20px rgba(51,255,51,0.15); }
        #start-menu.open { display: block; }
        #start-menu .menu-header { background: #33ff33; color: #0a0a0a; padding: 8px 12px; font-size: 20px; font-weight: bold; }
        #start-menu .menu-item { padding: 8px 12px; font-size: 18px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        #start-menu .menu-item:hover { background: #1a3a1a; }
        #start-menu .menu-divider { border-top: 1px solid #1a5e1a; margin: 4px 0; }
        
        /* Boot screen */
        #boot-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0a0a0a; z-index: 10000;
            display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s; }
        #boot-screen.hidden { opacity: 0; pointer-events: none; }
        .boot-text { font-size: 20px; color: #33ff33; margin: 4px 0; }
        .boot-dim { color: #1a5e1a; }
        .boot-bar { width: 300px; height: 20px; border: 1px solid #33ff33; margin-top: 16px; overflow: hidden; }
        .boot-fill { height: 100%; background: #33ff33; width: 0%; transition: width 0.3s; }
        
        /* Context menu */
        #context-menu { position: fixed; background: #111; border: 1px solid #33ff33; z-index: 700; display: none; min-width: 160px; }
        #context-menu .ctx-item { padding: 6px 16px; font-size: 16px; cursor: pointer; }
        #context-menu .ctx-item:hover { background: #1a3a1a; }
    </style>
</head>
<body>
    <div id="boot-screen">
        <div class="boot-text">ClawOS Desktop v2.0</div>
        <div class="boot-text boot-dim">Lobster Linux 6.ü¶û.0</div>
        <div class="boot-text boot-dim" id="boot-status">Initializing...</div>
        <div class="boot-bar"><div class="boot-fill" id="boot-fill"></div></div>
    </div>

    <div id="desktop"></div>
    
    <div id="start-menu">
        <div class="menu-header">ü¶û ClawOS</div>
        <div class="menu-item" data-app="calculator"><span>üßÆ</span> Calculator</div>
        <div class="menu-item" data-app="notepad"><span>üìù</span> Notepad</div>
        <div class="menu-item" data-app="weather"><span>üå§Ô∏è</span> Weather</div>
        <div class="menu-item" data-app="stocks"><span>üìà</span> Stocks</div>
        <div class="menu-item" data-app="terminal"><span>üíª</span> Terminal</div>
        <div class="menu-divider"></div>
        <div class="menu-item" data-app="about"><span>ü¶û</span> About ClawOS</div>
    </div>
    
    <div id="taskbar">
        <button id="start-btn">ü¶û START</button>
        <div id="taskbar-items"></div>
        <div id="taskbar-clock"></div>
    </div>
    
    <div id="context-menu"></div>
    <div class="scanlines"></div>
    <div class="crt-glow"></div>

<script type="module">
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ClawOS Desktop ‚Äî Window Manager
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Import apps
import CalculatorApp from './apps/calculator.js';
import NotepadApp from './apps/notepad.js';
import WeatherApp from './apps/weather.js';
import StocksApp from './apps/stocks.js';

const desktop = document.getElementById('desktop');
const taskbarItems = document.getElementById('taskbar-items');
const startMenu = document.getElementById('start-menu');
const startBtn = document.getElementById('start-btn');
const contextMenu = document.getElementById('context-menu');
const clock = document.getElementById('taskbar-clock');

let windows = [];
let windowIdCounter = 0;
let topZ = 10;
let dragState = null;
let resizeState = null;

// ‚îÄ‚îÄ App Registry ‚îÄ‚îÄ
const appRegistry = {
    calculator: { name: 'Calculator', icon: 'üßÆ', width: 340, height: 480, module: CalculatorApp },
    notepad: { name: 'Notepad', icon: 'üìù', width: 500, height: 400, module: NotepadApp },
    weather: { name: 'Weather', icon: 'üå§Ô∏è', width: 420, height: 440, module: WeatherApp },
    stocks: { name: 'Stocks', icon: 'üìà', width: 600, height: 480, module: StocksApp },
    terminal: { name: 'Terminal', icon: 'üíª', width: 700, height: 450, module: null },
    about: { name: 'About ClawOS', icon: 'ü¶û', width: 400, height: 300, module: null },
};

// ‚îÄ‚îÄ Desktop Icons ‚îÄ‚îÄ
const iconPositions = [
    { app: 'calculator', x: 20, y: 20 },
    { app: 'notepad', x: 20, y: 120 },
    { app: 'weather', x: 20, y: 220 },
    { app: 'stocks', x: 20, y: 320 },
    { app: 'terminal', x: 20, y: 420 },
];

function createDesktopIcons() {
    iconPositions.forEach(({ app, x, y }) => {
        const reg = appRegistry[app];
        const el = document.createElement('div');
        el.className = 'desktop-icon';
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.innerHTML = `<div class="icon">${reg.icon}</div><div class="label">${reg.name}</div>`;
        el.addEventListener('dblclick', () => openApp(app));
        desktop.appendChild(el);
    });
}

// ‚îÄ‚îÄ Window Management ‚îÄ‚îÄ
function openApp(appId) {
    startMenu.classList.remove('open');
    const reg = appRegistry[appId];
    if (!reg) return;
    
    const id = ++windowIdCounter;
    const x = 100 + (id * 30) % 200;
    const y = 50 + (id * 30) % 150;
    
    const win = document.createElement('div');
    win.className = 'window focused';
    win.dataset.id = id;
    win.style.cssText = `left:${x}px;top:${y}px;width:${reg.width}px;height:${reg.height}px;z-index:${++topZ};`;
    
    win.innerHTML = `
        <div class="window-titlebar">
            <span class="window-title">${reg.icon} ${reg.name}</span>
            <div class="window-controls">
                <span class="win-minimize" title="Minimize">_</span>
                <span class="win-maximize" title="Maximize">‚ñ°</span>
                <span class="win-close" title="Close">√ó</span>
            </div>
        </div>
        <div class="window-body"></div>
        <div class="window-resize"></div>
    `;
    
    desktop.appendChild(win);
    
    const body = win.querySelector('.window-body');
    const winData = { id, el: win, appId, reg, body, minimized: false, maximized: false, prevBounds: null, appInstance: null };
    windows.push(winData);
    
    // Init app
    if (appId === 'terminal') {
        initTerminalApp(body);
    } else if (appId === 'about') {
        initAboutApp(body);
    } else if (reg.module) {
        try {
            // Clone module to allow multiple instances
            const instance = Object.create(reg.module);
            instance.init(body);
            winData.appInstance = instance;
        } catch(e) {
            body.innerHTML = `<div style="padding:16px;color:#ff4444;">App failed to load: ${e.message}</div>`;
            console.error(`App ${appId} error:`, e);
        }
    }
    
    // Events
    const titlebar = win.querySelector('.window-titlebar');
    titlebar.addEventListener('mousedown', e => {
        if (e.target.closest('.window-controls')) return;
        focusWindow(winData);
        dragState = { win: winData, startX: e.clientX - win.offsetLeft, startY: e.clientY - win.offsetTop };
    });
    
    win.querySelector('.win-close').addEventListener('click', () => closeWindow(winData));
    win.querySelector('.win-minimize').addEventListener('click', () => minimizeWindow(winData));
    win.querySelector('.win-maximize').addEventListener('click', () => maximizeWindow(winData));
    win.querySelector('.window-resize').addEventListener('mousedown', e => {
        focusWindow(winData);
        resizeState = { win: winData, startX: e.clientX, startY: e.clientY, startW: win.offsetWidth, startH: win.offsetHeight };
        e.stopPropagation();
    });
    
    win.addEventListener('mousedown', () => focusWindow(winData));
    
    updateTaskbar();
    focusWindow(winData);
}

function focusWindow(winData) {
    windows.forEach(w => w.el.classList.remove('focused'));
    winData.el.classList.add('focused');
    winData.el.style.zIndex = ++topZ;
    updateTaskbar();
}

function closeWindow(winData) {
    if (winData.appInstance && winData.appInstance.destroy) {
        try { winData.appInstance.destroy(); } catch(e) {}
    }
    winData.el.remove();
    windows = windows.filter(w => w !== winData);
    updateTaskbar();
}

function minimizeWindow(winData) {
    winData.minimized = !winData.minimized;
    winData.el.style.display = winData.minimized ? 'none' : 'flex';
    updateTaskbar();
}

function maximizeWindow(winData) {
    if (winData.maximized) {
        const b = winData.prevBounds;
        winData.el.style.left = b.left; winData.el.style.top = b.top;
        winData.el.style.width = b.width; winData.el.style.height = b.height;
        winData.maximized = false;
    } else {
        winData.prevBounds = { left: winData.el.style.left, top: winData.el.style.top, width: winData.el.style.width, height: winData.el.style.height };
        winData.el.style.left = '0'; winData.el.style.top = '0';
        winData.el.style.width = '100%'; winData.el.style.height = '100%';
        winData.maximized = true;
    }
}

function updateTaskbar() {
    taskbarItems.innerHTML = '';
    windows.forEach(w => {
        const item = document.createElement('div');
        item.className = 'taskbar-item' + (w.el.classList.contains('focused') && !w.minimized ? ' active' : '');
        item.textContent = `${w.reg.icon} ${w.reg.name}`;
        item.addEventListener('click', () => {
            if (w.minimized) minimizeWindow(w);
            focusWindow(w);
        });
        taskbarItems.appendChild(item);
    });
}

// ‚îÄ‚îÄ Dragging & Resizing ‚îÄ‚îÄ
document.addEventListener('mousemove', e => {
    if (dragState) {
        const { win, startX, startY } = dragState;
        if (win.maximized) return;
        win.el.style.left = (e.clientX - startX) + 'px';
        win.el.style.top = Math.max(0, e.clientY - startY) + 'px';
    }
    if (resizeState) {
        const { win, startX, startY, startW, startH } = resizeState;
        const w = Math.max(300, startW + (e.clientX - startX));
        const h = Math.max(200, startH + (e.clientY - startY));
        win.el.style.width = w + 'px';
        win.el.style.height = h + 'px';
    }
});

document.addEventListener('mouseup', () => { dragState = null; resizeState = null; });

// ‚îÄ‚îÄ Start Menu ‚îÄ‚îÄ
startBtn.addEventListener('click', e => {
    e.stopPropagation();
    startMenu.classList.toggle('open');
});

document.addEventListener('click', e => {
    if (!startMenu.contains(e.target) && e.target !== startBtn) startMenu.classList.remove('open');
    contextMenu.style.display = 'none';
});

startMenu.querySelectorAll('.menu-item').forEach(item => {
    item.addEventListener('click', () => openApp(item.dataset.app));
});

// ‚îÄ‚îÄ Context Menu ‚îÄ‚îÄ
desktop.addEventListener('contextmenu', e => {
    e.preventDefault();
    contextMenu.innerHTML = `
        <div class="ctx-item" data-action="terminal">üíª Open Terminal</div>
        <div class="ctx-item" data-action="refresh">üîÑ Refresh Desktop</div>
        <div class="ctx-item" data-action="about">ü¶û About ClawOS</div>
    `;
    contextMenu.style.left = e.clientX + 'px';
    contextMenu.style.top = e.clientY + 'px';
    contextMenu.style.display = 'block';
    contextMenu.querySelectorAll('.ctx-item').forEach(item => {
        item.addEventListener('click', () => {
            openApp(item.dataset.action === 'refresh' ? '' : item.dataset.action);
            contextMenu.style.display = 'none';
        });
    });
});

// ‚îÄ‚îÄ Clock ‚îÄ‚îÄ
function updateClock() {
    const now = new Date();
    clock.textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
}
setInterval(updateClock, 1000);
updateClock();

// ‚îÄ‚îÄ Built-in: Terminal ‚îÄ‚îÄ
function initTerminalApp(container) {
    container.style.cssText = 'padding:12px;font-size:18px;overflow-y:auto;height:100%;';
    container.innerHTML = `
        <div id="term-output" style="min-height:calc(100% - 30px);"></div>
        <div style="display:flex;align-items:center;">
            <span style="color:#33ff33;">guest@clawos:~$ </span>
            <input id="term-input" style="background:none;border:none;color:#33ff33;font-family:'VT323',monospace;font-size:18px;flex:1;outline:none;caret-color:#33ff33;" autofocus>
        </div>
    `;
    const out = container.querySelector('#term-output');
    const inp = container.querySelector('#term-input');
    const tprint = (t, color) => { const d = document.createElement('div'); d.textContent = t; if(color) d.style.color = color; out.appendChild(d); container.scrollTop = container.scrollHeight; };
    
    tprint('ClawOS Terminal v2.0', '#66ff66');
    tprint('Type "help" for commands. This is the desktop edition!', '#1a9e1a');
    tprint('');
    
    inp.addEventListener('keydown', e => {
        if (e.key !== 'Enter') return;
        const cmd = inp.value.trim(); inp.value = '';
        tprint(`$ ${cmd}`, '#1a9e1a');
        if (!cmd) return;
        if (cmd === 'help') { tprint('Commands: help, echo, date, whoami, neofetch, fortune, clear, open <app>'); }
        else if (cmd === 'clear') { out.innerHTML = ''; }
        else if (cmd === 'date') { tprint(new Date().toString()); }
        else if (cmd === 'whoami') { tprint('guest'); }
        else if (cmd.startsWith('echo ')) { tprint(cmd.slice(5)); }
        else if (cmd === 'fortune') {
            const f = ['A lobster in the terminal is worth two in the cloud.','Your code will compile on the first try. (Lie probability: 97%)','Have you tried turning it off and on again?','ü¶û clack clack'];
            tprint(f[Math.floor(Math.random()*f.length)], '#ffaa00');
        }
        else if (cmd === 'neofetch') { tprint('ClawOS Desktop v2.0 | Lobster Linux | JS ES2026 | Theme: green', '#00ffff'); }
        else if (cmd.startsWith('open ')) { openApp(cmd.slice(5).trim()); tprint(`Opening ${cmd.slice(5)}...`); }
        else { tprint(`command not found: ${cmd}`, '#ff4444'); }
    });
    setTimeout(() => inp.focus(), 100);
}

// ‚îÄ‚îÄ Built-in: About ‚îÄ‚îÄ
function initAboutApp(container) {
    container.style.cssText = 'padding:24px;font-size:18px;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;';
    container.innerHTML = `
        <div style="font-size:64px;margin-bottom:12px;">ü¶û</div>
        <div style="font-size:28px;color:#66ff66;margin-bottom:8px;">ClawOS Desktop v2.0</div>
        <div style="color:#1a9e1a;margin-bottom:16px;">Built by OpenClaw + Gemini 3 Pro (via OpenCode)</div>
        <div style="color:#1a9e1a;font-size:16px;max-width:340px;line-height:1.4;">
            An AI woke up on Feb 8, 2026. It was given a blank repo and told to get creative.
            This is what happened.<br><br>
            Window Manager: OpenClaw (Claude Opus)<br>
            Calculator: Gemini 3 Pro<br>
            Notepad: Gemini 3 Pro<br>
            Weather: Gemini 3 Pro<br>
            Stocks: Gemini 3 Pro<br><br>
            <span style="color:#33ff33;">4 agents. 1 orchestrator. 0 templates.</span>
        </div>
        <div style="margin-top:16px;color:#484f58;">hello-claw.lukewalsh.com</div>
    `;
}

// ‚îÄ‚îÄ Boot Sequence ‚îÄ‚îÄ
function boot() {
    const bootScreen = document.getElementById('boot-screen');
    const bootFill = document.getElementById('boot-fill');
    const bootStatus = document.getElementById('boot-status');
    
    const steps = [
        { msg: 'Loading kernel modules...', pct: 15, delay: 300 },
        { msg: 'Mounting /dev/lobster...', pct: 30, delay: 600 },
        { msg: 'Starting window manager...', pct: 45, delay: 900 },
        { msg: 'Loading Calculator app...', pct: 55, delay: 1100 },
        { msg: 'Loading Notepad app...', pct: 65, delay: 1300 },
        { msg: 'Loading Weather app...', pct: 75, delay: 1500 },
        { msg: 'Loading Stocks app...', pct: 85, delay: 1700 },
        { msg: 'Feeding the lobster...', pct: 95, delay: 2000 },
        { msg: 'Ready! ü¶û', pct: 100, delay: 2300 },
    ];
    
    steps.forEach(({ msg, pct, delay }) => {
        setTimeout(() => { bootStatus.textContent = msg; bootFill.style.width = pct + '%'; }, delay);
    });
    
    setTimeout(() => {
        bootScreen.classList.add('hidden');
        setTimeout(() => bootScreen.remove(), 500);
        createDesktopIcons();
    }, 2800);
}

boot();
</script>
</body>
</html>
